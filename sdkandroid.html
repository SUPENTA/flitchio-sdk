

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-60421016-4']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Flitchio SDK for Android &mdash; Flitchio SDK 0.7.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/supenta.css" type="text/css" />
  

  

  
    <link rel="top" title="Flitchio SDK 0.7.0 documentation" href="index.html"/>
        <link rel="next" title="Flitchio SDK for Unity 3D" href="sdkunity.html"/>
        <link rel="prev" title="Getting started" href="overview.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Flitchio SDK
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#overview-of-the-device">Overview of the device</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#communicate-with-flitchio">Communicate with Flitchio</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Flitchio SDK for Android</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#add-the-sdk-to-your-project">Add the SDK to your project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bind-to-flitchio">Bind to Flitchio</a></li>
<li class="toctree-l2"><a class="reference internal" href="#follow-status-changes">Follow status changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-data-from-flitchio">Get data from Flitchio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listening-mode">Listening Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#polling-mode">Polling Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-best-practices">Troubleshooting &amp; Best practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debug-logs">Debug logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshoot-the-reasons-of-a-failed-binding">Troubleshoot the reasons of a failed binding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#receive-event-callbacks-on-a-particular-thread">Receive event callbacks on a particular thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keep-your-screen-on-while-using-flitchio">Keep your screen on while using Flitchio</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sdkunity.html">Flitchio SDK for Unity 3D</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sdkunity.html#add-the-sdk-to-your-project">Add the SDK to your project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use cases and ideas for Flitchio</a></li>
<li class="toctree-l1"><a class="reference internal" href="flitchioime.html">Enable Flitchio compatibility without Flitchio SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Feedback &amp; Support</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Flitchio SDK</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Flitchio SDK for Android</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/sdkandroid.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="flitchio-sdk-for-android">
<h1>Flitchio SDK for Android<a class="headerlink" href="#flitchio-sdk-for-android" title="Permalink to this headline">¶</a></h1>
<div class="section" id="add-the-sdk-to-your-project">
<h2>Add the SDK to your project<a class="headerlink" href="#add-the-sdk-to-your-project" title="Permalink to this headline">¶</a></h2>
<p>Make sure that the <a class="reference external" href="http://developer.android.com/sdk/index.html">Android SDK</a> in correctly installed on your computer before reading on.</p>
<p>The Flitchio SDK is very lightweight and simple.
To integrate it to your project, just add the dependency to your build.gradle:</p>
<pre class="literal-block">
dependencies {
    compile 'com.supenta.flitchio:sdk:0.7.0'
}
</pre>
<p>Refresh Gradle, and you&#8217;re done.
You can now import and use the <a class="reference external" href="http://dev.flitch.io/javadoc/">classes from the Flitchio SDK</a>.</p>
</div>
<div class="section" id="bind-to-flitchio">
<h2>Bind to Flitchio<a class="headerlink" href="#bind-to-flitchio" title="Permalink to this headline">¶</a></h2>
<p>As depicted in the picture <a class="reference internal" href="overview.html#fig-software-architecture"><span>Overall software architecture</span></a>, your app does not interact directly with Flitchio but rather gets its data from the Flitchio Manager app which acts like a bridge.
Whenever your app wants to gather input data from Flitchio, it needs to bind to the Flitchio Manager app using an instance of <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html"><code class="docutils literal"><span class="pre">FlitchioController</span></code></a>.
After binding, you may either listen to new events (<a class="reference internal" href="#listening-mode"><span>listening mode</span></a>) or poll for new data (<a class="reference internal" href="#polling-mode"><span>polling mode</span></a>).
Whichever mode you choose, the initial setup is the same.</p>
<p>Get an instance of <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html"><code class="docutils literal"><span class="pre">FlitchioController</span></code></a> with <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#getInstance-android.content.Context-"><code class="docutils literal"><span class="pre">getInstance()</span></code></a>.
The context you pass can be either an Activity or a Service: <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html"><code class="docutils literal"><span class="pre">FlitchioController</span></code></a> can be used by both.
Whichever context you use, you <strong>must</strong> tie the controller to your context lifecycle by calling these 4 methods at appropriate moments:</p>
<ul class="simple">
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#onCreate-com.supenta.flitchio.sdk.FlitchioStatusListener-"><code class="docutils literal"><span class="pre">onCreate()</span></code></a> to initialise the controller and bind to the Flitchio Manager app.</li>
<li><code class="docutils literal"><span class="pre">onResume()</span></code> to start monitoring status changes.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#onPause--"><code class="docutils literal"><span class="pre">onPause()</span></code></a> to pause the monitoring of status changes.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#onDestroy--"><code class="docutils literal"><span class="pre">onDestroy()</span></code></a> to terminate the controller properly.</li>
</ul>
<p>If you don&#8217;t call all of these 4 methods, your app may behave incorrectly.</p>
<p>Here is the typical initial setup for an Activity:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">FlitchioController</span> <span class="n">flitchioController</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">flitchioController</span> <span class="o">=</span> <span class="n">FlitchioController</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">statusListener</span> <span class="cm">/* see below */</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>

        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>And here is the typical initial setup for a Service:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BackgroundService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">FlitchioController</span> <span class="n">flitchioController</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">FlitchioStatusListener</span> <span class="n">statusListener</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">flitchioController</span> <span class="o">=</span> <span class="n">FlitchioController</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">statusListener</span> <span class="cm">/* see below */</span><span class="o">);</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The typical implementation of the <code class="docutils literal"><span class="pre">statusListener</span></code> is explained in <a class="reference internal" href="#follow-status-changes"><span>Follow status changes</span></a>.</p>
</div>
<div class="section" id="follow-status-changes">
<span id="id1"></span><h2>Follow status changes<a class="headerlink" href="#follow-status-changes" title="Permalink to this headline">¶</a></h2>
<p>Because the controller initialisation is asynchronous, you need to register a <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioStatusListener.html"><code class="docutils literal"><span class="pre">FlitchioStatusListener</span></code></a> to follow its status changes.
Your status listener will get a status callback at every important moment in the lifetime of your controller, such as:</p>
<ul class="simple">
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#BINDING"><code class="docutils literal"><span class="pre">Status.BINDING</span></code></a> when you asked for a binding but it hasn&#8217;t completed yet. This is usually the first status callback.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#BOUND"><code class="docutils literal"><span class="pre">Status.BOUND</span></code></a> when your binding has completed.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#CONNECTED"><code class="docutils literal"><span class="pre">Status.CONNECTED</span></code></a> when your binding is complete and Flitchio is connected to the phone. This is the moment you can start <a class="reference internal" href="#get-data"><span>getting data from Flitchio</span></a>.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#DISCONNECTED"><code class="docutils literal"><span class="pre">Status.DISCONNECTED</span></code></a> when your binding is complete but Flitchio is disconnected from the phone. You can for example display a message to your user asking them to connect Flitchio to the phone.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#BINDING_FAILED"><code class="docutils literal"><span class="pre">Status.BINDING_FAILED</span></code></a> when your controller couldn&#8217;t bind. This can happen for several reasons, read <a class="reference internal" href="#failure-reasons"><span>Troubleshoot the reasons of a failed binding</span></a> for details.</li>
</ul>
<p>Check the <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html"><code class="docutils literal"><span class="pre">Status</span></code></a> API reference for an overview for all the possible statuses.</p>
<p>Here&#8217;s a typical implementation of the status listener:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">flitchioController</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="k">new</span> <span class="n">FlitchioStatusListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFlitchioStatusChanged</span><span class="o">(</span><span class="n">Status</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">status</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="na">BOUND</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Yay, binding is effective!</span>

        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">status</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="na">CONNECTED</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">startGettingDataFromFlitchio</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">status</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="na">DISCONNECTED</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">askUserToConnectFlitchio</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">status</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="na">BINDING_FAILED</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">failureReason</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="na">failureReason</span><span class="o">;</span>

            <span class="c1">// See section &quot;Troubleshoot the reasons of a failed binding&quot;</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="s">&quot;Not reacting on status: &quot;</span><span class="o">+</span><span class="n">status</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>
</div>
<p>Note: in this example, the status listener is implemented as an anonymous class, but you can of course let your Activity/Service implement <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioStatusListener.html"><code class="docutils literal"><span class="pre">FlitchioStatusListener</span></code></a> or create another class instead.</p>
<p>If you don&#8217;t care whether or not your controller gets bound and do not wish to follow the connection status of Flitchio, you can pass null as argument of <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#onCreate-com.supenta.flitchio.sdk.FlitchioStatusListener-"><code class="docutils literal"><span class="pre">FlitchioController.onCreate</span></code></a>.</p>
<p>In addition to the status callbacks, you can also check your controller&#8217;s status at any time by calling <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#getStatus--"><code class="docutils literal"><span class="pre">FlitchioController.getStatus</span></code></a>.</p>
</div>
<div class="section" id="get-data-from-flitchio">
<span id="get-data"></span><h2>Get data from Flitchio<a class="headerlink" href="#get-data-from-flitchio" title="Permalink to this headline">¶</a></h2>
<p>As soon as your controller is in <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#CONNECTED"><code class="docutils literal"><span class="pre">Status.CONNECTED</span></code></a>, you are able to get data from Flitchio.
There are two ways of accessing this data:</p>
<ul class="simple">
<li>Either your app implements an <strong>event listener</strong> to receive button and direction events (newly pressed or released, joystick moving, pressure variations).</li>
<li>Or your app actively <strong>polls</strong> and repeatedly requests the newest state of Flitchio (pressure applied on the buttons/directions and coordinates of the joysticks at a given moment).</li>
</ul>
<p>Whether you listen or poll is entirely your design decision.
Listening mode is simpler to implement at first sight and more suitable for standard Android apps.
Indeed, listening for events is a concept widely used in the basic Android framework itself.
On the other hand, polling mode is often useful for apps designed to have a rendering loop updating the display at high frequency.
That&#8217;s typically the case of Android games that use a SurfaceView or a GLSurfaceView to draw.</p>
<div class="section" id="listening-mode">
<span id="id2"></span><h3>Listening Mode<a class="headerlink" href="#listening-mode" title="Permalink to this headline">¶</a></h3>
<p>If you want to listen for incoming events, all you need to do is implement a <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioEventListener.html"><code class="docutils literal"><span class="pre">FlitchioEventListener</span></code></a> and pass it in <code class="docutils literal"><span class="pre">onResume(FlitchioEventListener)</span></code> instead of using the simple version with no parameter.</p>
<p>Here is an example of a typical controller lifecycle in listening mode for button and joystick events:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">FlitchioController</span> <span class="n">flitchioController</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">flitchioController</span> <span class="o">=</span> <span class="n">FlitchioController</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">statusListener</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>

        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onResume</span><span class="o">(</span><span class="n">eventListener</span> <span class="cm">/* see below */</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Once the controller is bound to Flitchio Manager, Flitchio is connected, and the <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioEventListener.html"><code class="docutils literal"><span class="pre">FlitchioEventListener</span></code></a> is registered, you will receive:</p>
<ul class="simple">
<li>a <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/ButtonEvent.html"><code class="docutils literal"><span class="pre">ButtonEvent</span></code></a> whenever the user presses or releases a button/direction of Flitchio, or varies the pressure;</li>
<li>a <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/JoystickEvent.html"><code class="docutils literal"><span class="pre">JoystickEvent</span></code></a> whenever the user moves a joystick of Flitchio.</li>
</ul>
<p>Here&#8217;s a typical implementation of the event listener:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">flitchioController</span><span class="o">.</span><span class="na">onResume</span><span class="o">(</span><span class="k">new</span> <span class="n">FlitchioEventListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFlitchioButtonEvent</span><span class="o">(</span><span class="n">InputElement</span><span class="o">.</span><span class="na">Button</span> <span class="n">source</span><span class="o">,</span> <span class="n">ButtonEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="n">ButtonEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// The source button has just been pressed</span>
        <span class="o">}</span>

        <span class="kt">float</span> <span class="n">pressure</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getPressure</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pressure</span> <span class="o">&gt;</span> <span class="mf">0.5f</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// The source button is being pressed strongly</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">source</span> <span class="o">==</span> <span class="n">InputElement</span><span class="o">.</span><span class="na">BUTTON_TOP</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// The top shoulder button was pressed, released, or its pressure has changed</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">source</span> <span class="o">==</span> <span class="n">InputElement</span><span class="o">.</span><span class="na">DPAD_BOTTOM_LEFT</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// The left direction on bottom joystick was pressed or released</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFlitchioJoystickEvent</span><span class="o">(</span><span class="n">InputElement</span><span class="o">.</span><span class="na">Joystick</span> <span class="n">source</span><span class="o">,</span> <span class="n">JoystickEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">source</span> <span class="o">==</span> <span class="n">InputElement</span><span class="o">.</span><span class="na">JOYSTICK_TOP</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// The top joystick has moved</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>
</div>
<p>Note: in this example, the event listener is implemented as an anonymous class, but you can of course let your Activity/Service implement <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioEventListener.html"><code class="docutils literal"><span class="pre">FlitchioEventListener</span></code></a> or create another class instead.</p>
<p>These event callbacks, by default, are executed on an arbitrary thread different from the main thread.
To define on which thread you want to receive the event callbacks, please check <a class="reference internal" href="#define-thread-callbacks"><span>Receive event callbacks on a particular thread</span></a>.</p>
</div>
<div class="section" id="polling-mode">
<span id="id3"></span><h3>Polling Mode<a class="headerlink" href="#polling-mode" title="Permalink to this headline">¶</a></h3>
<p>When in polling mode, your app actively asks for the current state of Flitchio.
This state is represented by a <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioSnapshot.html"><code class="docutils literal"><span class="pre">FlitchioSnapshot</span></code></a> object that contains information about all the pressed buttons and all the joystick positions at a given moment.
In each iteration of your game/rendering loop, call <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#obtainSnapshot--"><code class="docutils literal"><span class="pre">obtainSnapshot()</span></code></a> to get the latest state of Flitchio.</p>
<p>For the sake of the example, let&#8217;s assume that your display is continuously updated in a method called <code class="docutils literal"><span class="pre">update()</span></code>.
You would then be able to query the current state like this:</p>
<div class="highlight-java"><div class="highlight"><pre>void update() {

    if (flitchioController != null &amp;&amp; flitchioController.getStatus().code == Status#CONNECTED) {
        // Retrieve the current state of Flitchio
        FlitchioSnapshot snapshot = flitchioController.obtainSnapshot();

        if (snapshot.getJoystickX(JOYSTICK_TOP) == 0.0f &amp;&amp;
            snapshot.getJoystickY(JOYSTICK_TOP) == 0.0f) {
            // The top joystick is in central position
        }

        if (snapshot.getButtonPressure(BUTTON_BOTTOM) &gt; 0.5f) {
            // The bottom shoulder button is being pressed strongly
        }
    }
}
</pre></div>
</div>
<p><strong>Important note:</strong> after calling <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#onCreate-com.supenta.flitchio.sdk.FlitchioStatusListener-"><code class="docutils literal"><span class="pre">onCreate()</span></code></a>, you can&#8217;t immediately start polling, because your controller is still initialising.
Polling is possible as soon as you get a status callback with <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#CONNECTED"><code class="docutils literal"><span class="pre">Status.CONNECTED</span></code></a>.</p>
</div>
</div>
<div class="section" id="troubleshooting-best-practices">
<h2>Troubleshooting &amp; Best practices<a class="headerlink" href="#troubleshooting-best-practices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debug-logs">
<h3>Debug logs<a class="headerlink" href="#debug-logs" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html"><code class="docutils literal"><span class="pre">FlitchioController</span></code></a> outputs debug information if something goes wrong, for example when the connection with the Flitchio Manager app breaks.
Those logs are identified by the tag <code class="docutils literal"><span class="pre">Flitchio</span></code>.</p>
<p>If you remove logging in your app with Proguard, the <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html"><code class="docutils literal"><span class="pre">FlitchioController</span></code></a> will not log either.</p>
</div>
<div class="section" id="troubleshoot-the-reasons-of-a-failed-binding">
<span id="failure-reasons"></span><h3>Troubleshoot the reasons of a failed binding<a class="headerlink" href="#troubleshoot-the-reasons-of-a-failed-binding" title="Permalink to this headline">¶</a></h3>
<p>If you get a status callback with <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#BINDING_FAILED"><code class="docutils literal"><span class="pre">Status.BINDING_FAILED</span></code></a>, it means that either a binding attempt hasn&#8217;t succeeded, or the existing binding has ended unexpectedly.
You can troubleshoot the reason of this failure by checking the <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.html#failureReason"><code class="docutils literal"><span class="pre">Status.failureReason</span></code></a> field of this status.
Here are the most common reasons:</p>
<ul class="simple">
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.FailingStatus.html#REASON_MANAGER_UNUSABLE"><code class="docutils literal"><span class="pre">Status.FailingStatus.REASON_MANAGER_UNUSABLE</span></code></a>: the user doesn&#8217;t have the Flitchio Manager app installed on their phone, or they have an outdated version. In both cases, they need to download the latest version from the Play Store. <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#getPlayStoreIntentForFlitchioManager--"><code class="docutils literal"><span class="pre">FlitchioController.getPlayStoreIntentForFlitchioManager</span></code></a> can help you for that. Alternatively, you can check the version of the SDK with <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#getVersionCode--"><code class="docutils literal"><span class="pre">FlitchioController.getVersionCode</span></code></a> and the version of Flitchio Manager on the user&#8217;s phone with <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#getFlitchioManagerVersionCode-android.content.Context-"><code class="docutils literal"><span class="pre">FlitchioController.getFlitchioManagerVersionCode</span></code></a>.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.FailingStatus.html#REASON_SERVICE_UNREACHABLE"><code class="docutils literal"><span class="pre">Status.FailingStatus.REASON_SERVICE_UNREACHABLE</span></code></a>: the Flitchio Manager app cannot be reached for an unexpected reason.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.FailingStatus.html#REASON_SERVICE_REFUSED_CONNECTION"><code class="docutils literal"><span class="pre">Status.FailingStatus.REASON_SERVICE_REFUSED_CONNECTION</span></code></a>: this controller has not been accepted by Flitchio Manager.</li>
<li><a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/Status.FailingStatus.html#REASON_SERVICE_SHUTDOWN_CONNECTION"><code class="docutils literal"><span class="pre">Status.FailingStatus.REASON_SERVICE_SHUTDOWN_CONNECTION</span></code></a>: the binding with Flitchio Manager ended unexpectedly. Try to restart the app.</li>
</ul>
</div>
<div class="section" id="receive-event-callbacks-on-a-particular-thread">
<span id="define-thread-callbacks"></span><h3>Receive event callbacks on a particular thread<a class="headerlink" href="#receive-event-callbacks-on-a-particular-thread" title="Permalink to this headline">¶</a></h3>
<p>By default, all the callback methods of <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioEventListener.html"><code class="docutils literal"><span class="pre">FlitchioEventListener</span></code></a> are executed on an arbitrary non-UI thread, different from the main thread.
This can be problematic if you try to do UI operations in those callbacks, such as updating Views: your app will crash.
You can change the default behaviour by passing to <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioController.html#onResume-com.supenta.flitchio.sdk.FlitchioEventListener-android.os.Handler-"><code class="docutils literal"><span class="pre">FlitchioController.onResume</span></code></a> a reference to a Handler object associated to the thread you want to receive the callbacks in.</p>
<p>In particular, if you want to receive these callbacks on the UI thread, you would do:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>

    <span class="n">flitchioController</span><span class="o">.</span><span class="na">onResume</span><span class="o">(</span><span class="n">eventListener</span><span class="o">,</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">());</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">flitchioController</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>

    <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that the status callbacks of <a class="reference external" href="http://dev.flitch.io/javadoc/com/supenta/flitchio/sdk/FlitchioStatusListener.html"><code class="docutils literal"><span class="pre">FlitchioStatusListener</span></code></a> will always happen on the main thread.</p>
</div>
<div class="section" id="keep-your-screen-on-while-using-flitchio">
<h3>Keep your screen on while using Flitchio<a class="headerlink" href="#keep-your-screen-on-while-using-flitchio" title="Permalink to this headline">¶</a></h3>
<p>Remember that <strong>NFC is turned off as long as the screen is off</strong>.
This should not bother you, though.
When the screen is turned on again, Flitchio is automatically detected again and your app reconnects without any problem.</p>
<p>However, keep in mind that bare NFC communication does not prevent the touchscreen from turning off automatically when the user didn&#8217;t touch it.
If your app solely depends on input from Flitchio, i.e. the user doesn&#8217;t use the touchscreen, make sure to tell Android not to turn off the screen:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>

        <span class="n">keepScreenOn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">keepScreenOn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

        <span class="n">flitchioController</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">keepScreenOn</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">keepScreenOn</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">getWindow</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">keepScreenOn</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Tell Android to keep the screen on while this window is visible to</span>
                <span class="c1">// the user.</span>
                <span class="n">getWindow</span><span class="o">().</span><span class="na">addFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_KEEP_SCREEN_ON</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// Release window flag to make screen turn off if needed</span>
                <span class="c1">// (this has no effect if flag wasn&#39;t set).</span>
                <span class="n">getWindow</span><span class="o">().</span><span class="na">clearFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_KEEP_SCREEN_ON</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>There are other possibilities to keep the screen on. Check out this <a class="reference external" href="http://stackoverflow.com/a/18487237/2923406">answer</a> on StackOverflow.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sdkunity.html" class="btn btn-neutral float-right" title="Flitchio SDK for Unity 3D" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral" title="Getting started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, SUPENTA.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>